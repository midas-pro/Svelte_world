<Editor :article on:publish='update(event.article)' :inProgress/>

<script>
	import { goto } from 'sapper/runtime/app.js';
	import Editor from './_EditorPage.html';
	import store from '../_store.js';
	import * as api from '../_api.js';

	export default {
		components: {
			Editor
		},

		store: () => store,

		preload({ params }) {
			return api.get(`articles/${params.slug}`);
		},

		data() {
			return {
				inProgress: false
			};
		},

		methods: {
			update(article) {
				const { slug } = this.get('params');

				console.log(article, slug);

				this.set({ inProgress: true });

				api.put(`articles/${slug}`, { article }).then(response => {
					if (response.article) {
						goto(`/article/${response.article.slug}`);
					}
				});
			}
		}
	};
</script>