<Editor :user :article on:publish='create(event.article)' :inProgress/>

<script>
	import { goto } from 'sapper/runtime.js';
	import Editor from './_EditorPage.html';
	import * as api from '../_api.js';
	import { user } from '../_auth.js';

	export default {
		components: {
			Editor
		},

		preload({ session }) {
			return {
				user: session ? session.user : user
			};
		},

		data() {
			return {
				article: {
					title: '',
					description: '',
					body: '',
					tagInput: ''
				},
				inProgress: false
			};
		},

		methods: {
			create(article) {
				this.set({ inProgress: true });

				const { user } = this.get();

				api.post('articles', { article }, user && user.token).then(response => {
					if (response.article) {
						goto(`/article/${response.article.slug}`);
					}
				});
			}
		}
	};
</script>